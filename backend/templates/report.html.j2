<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>AutoVuln Report</title>
    <style>
        body { font-family: Arial, sans-serif; color: #111; padding: 24px; }
        h1, h2 { color: #0b3d91; }
        .chip { display:inline-block; padding:4px 8px; border-radius:12px; color:white; margin-right:4px; }
        .Critical { background:#b30000; }
        .High { background:#d9534f; }
        .Medium { background:#f0ad4e; }
        .Low { background:#5bc0de; }
        table { width:100%; border-collapse: collapse; margin-top:12px; }
        th, td { border:1px solid #ccc; padding:8px; font-size:12px; vertical-align: top; }
    </style>
</head>
<body>
    <h1>AutoVuln Security Assessment Report</h1>
    <p><strong>Scan ID:</strong> {{ scan_id }}</p>
    <p><strong>Target:</strong> {{ target_url }}</p>
    <p><strong>Generated:</strong> {{ generated_at }}</p>

    <h2>Executive Summary</h2>
    <p>Overall Risk Score: <strong>{{ risk.score }}/100 ({{ risk.label }})</strong></p>

    <h2>Attack Surface</h2>
    <p>Automated reconnaissance was performed with Nmap and WhatWeb to identify open ports, services, and exposed technologies.</p>

    <h2>Findings Table</h2>
    <p>
        {% for sev, count in risk.distribution.items() %}
            <span class="chip {{ sev }}">{{ sev }}: {{ count }}</span>
        {% endfor %}
    </p>
    <table>
        <thead>
            <tr><th>Severity</th><th>Title</th><th>Tool</th><th>Evidence</th><th>Remediation</th></tr>
        </thead>
        <tbody>
        {% for f in findings %}
            <tr>
                <td>{{ f.severity }}</td>
                <td>{{ f.title }}</td>
                <td>{{ f.source_tool }}</td>
                <td>{{ f.evidence }}</td>
                <td>{{ f.remediation }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>


    <h2>Simulation & Measurement</h2>
    <p><strong>Baseline Avg Latency:</strong> {{ metrics.get("baseline_http", {}).get("avg_latency_ms", 0) }} ms</p>
    <p><strong>Post-Scan Avg Latency:</strong> {{ metrics.get("post_scan_http", {}).get("avg_latency_ms", 0) }} ms</p>
    <p><strong>Simulation Requests Sent:</strong> {{ metrics.get("simulation", {}).get("requests_sent", 0) }}</p>
    <p><strong>Simulation Blocked Rate:</strong> {{ metrics.get("simulation", {}).get("blocked_rate", 0) }}</p>
    <p><strong>Total Scan Duration:</strong> {{ metrics.get("duration_seconds", 0) }} s</p>

    <h2>Technical Details</h2>
    {% for sev, items in grouped.items() %}
        <h3>{{ sev }}</h3>
        {% for item in items %}
            <p><strong>{{ item.title }}</strong> â€” {{ item.description }}</p>
            <p><em>Evidence:</em> {{ item.evidence }}</p>
        {% endfor %}
    {% endfor %}

    <h2>Remediation Plan</h2>
    <ul>
        <li>Patch and harden all internet-facing services.</li>
        <li>Restrict administrative surfaces and sensitive endpoints.</li>
        <li>Add secure headers and centralized logging/alerting.</li>
    </ul>
</body>
</html>
